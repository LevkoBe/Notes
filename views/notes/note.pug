extends ../layout

//- todo: add patching functionality

block content
    .container
        h2 Note Information

        // Title section
        .note-section
            label Title:
            if editableTitle
                input(type="text" name="title" value=note.title)
            else
                span#titleText #{note.title}
                span.edit-icon(class=editableTitle ? 'hidden' : '', onclick="toggleEditable('title')") &#9998;

        // Content section
        .note-section
            label Content:
            if editableContent
                textarea(name="content") #{note.content}
            else
                p#contentText #{note.content}
                span.edit-icon(class=editableContent ? 'hidden' : '', onclick="toggleEditable('content')") &#9998;

        // Importance section
        .note-section
            label Importance:
            span.importance-buttons
                button.btn.btn-sm.btn-danger(type="button" onclick="changeImportance(-1)") -
                span#importanceText #{note.importance}
                button.btn.btn-sm.btn-success(type="button" onclick="changeImportance(1)") +

        // Completed section
        .note-section
            label Completed:
            input#completedCheckbox(type="checkbox" checked=note.completed, onchange="toggleCompleted()")

        // Update button
        button.btn.btn-primary(id="updateBtn" onclick="updateNote()") Update

        // Comment button
        button.btn.btn-secondary(id="commentBtn" onclick="showCommentForm()") Comment

        // Comment form (initially hidden)
        form#commentForm(action=`/notes/${note._id}/comment`, method="POST" style="display: none;")
            textarea(name="comment" placeholder="Add a comment...")
            button.btn.btn-success(type="submit") Submit

    script.
        var editableTitle = false;
        var editableContent = false;

        function toggleEditable(section) {
            if (section === 'title') {
                editableTitle = !editableTitle;
                document.getElementById('titleText').classList.toggle('hidden');
                document.querySelector('input[name="title"]').classList.toggle('hidden');
            } else if (section === 'content') {
                editableContent = !editableContent;
                document.getElementById('contentText').classList.toggle('hidden');
                document.querySelector('textarea[name="content"]').classList.toggle('hidden');
            }
        }

        function changeImportance(change) {
            var importance = parseInt(document.getElementById('importanceText').innerText);
            importance += change;
            document.getElementById('importanceText').innerText = importance;
        }

        function toggleCompleted() {
            var checkbox = document.getElementById('completedCheckbox');
            checkbox.checked = !checkbox.checked;
        }

        function updateNote() {
            // Implement updating the note via AJAX or form submission
        }

        function showCommentForm() {
            var commentForm = document.getElementById('commentForm');
            commentForm.style.display = 'block';
        }
